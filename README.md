# Задачи по практической робототехнике
## Задача на зачет
Наземный робот на базе ТРИК и квадрокоптер стоят в зоне старта. Квадрокоптер взлетает, делает пролет над "городом", снимает и составляет карту, а также определят координату (объект), куда необходимо приехать наземному роботу. Пересылает координату и карту наземному роботу.
Наземный по оптимальному пути двигается по карте в заданную координату, при этом корректируя движения по лидару, гироскопу и энкодерам.

## Промежуточные задачи, которые необходимо сдать
- [X] Написать функцию `run(v,s)` перемещение робота на расстояние s со скоростью v. Корректировку направления сделать с помощью П-регулятора по энкодерам.
- [X] Написать функцию `rotate(v,alpha)` поворота робота на угол alpha со скоростью v. 
- [X] *(Дополнительно)* Дополнить функцию `run(v,s)` П-регулятором по значениям энкодеров.
- [X] Реализовать функцию расчета абсолютно угла по гироскопу, который висит на событии таймера. Реализовать функцию движения с выравниванием на угол.
Проверить первые 3 задачи в 2Д и на реальном роботе.
- [X] *(Дополнительно)* Реализовать функцию `run(v,s)` с использованием обоих типов регуляторов (взвешенная сумма)
- [X] Научиться работать с квадрокоптером: настройка, прошивка, подключение к пульту. Управление квадрокоптером с пульта.
- [X] Написать программу автоматического пролета по заданным точка со взлетом и посадкой.
- [ ] Написать программу съемки с камеры. Склейкой кадров, бинаризации изображения.
- [ ] Реализовать объединение квадрокоптера и наземного робота в одну сеть. Научиться передавать данные с квадрокоптера на наземного робота.

## Работа с Пионер Макс
### Подготовка
1) Убедиться в целостности сборки ([инструкция по сборке](https://docs.geoscan.ru/pioneer/instructions/pioneer-max/const/max-const_main.html))
2) [Прошить](https://docs.geoscan.ru/pioneer/instructions/pioneer-max/settings/firmware_upgrade.html) Пионер Макс прошивкой для ROS (или убедиться, что она уже установлена)
   и загрузить параметры для автопилота для ROS
3) [Установить](https://docs.geoscan.ru/pioneer/programming/pioneer_max/prep/install_image.html) образ для бортового компьютера Raspberry Pi
4) Настроить и подключить пульт ([инструкция](https://docs.geoscan.ru/pioneer/instructions/remote-controller/fsi6s/fsi6s.html))
5) Убедиться в работоспособности автопилота, запустив квадрокоптер со 2-м переключателем в среднем положении (режим работы с системой навигации).
   Если отпустить стики, квадрокоптер должен сохранять высоту и положение.
> [!CAUTION]
> При переходе на полностью ручное управление во время полёта (2-й переключатель в верхнем положении) будьте готовы к резкой смене высоты или курса.
> В этом режиме автопилот отключается. Для перехвата управления во время выполнения полётного задания проще использовать среднее положение переключателя (режим работы с системой навигации)

### Запуск полётной программы с Raspberry Pi
1) Подключиться к точке доступа (по умолчанию имя сети - `GeoscanTest`, пароль - `geoscan123`)
2) Подключиться к Raspberry по SSH:
   ```bash
   ssh ubuntu@10.0.0.31
   ```
4) Запустить `ros_plaz_node`
   ```bash
   rospioneer start
   ```
5) Запустить программу
   ```bash
   python3 script.py
   ```
> [!NOTE]
> Примеры программ можно найти на Raspberry в `/home/ubuntu/geoscan_ws/` и в [репозитории](https://github.com/geoscan/gs_example)

### Если скрипт на дроне не запустился, а дрон просто пикнул.
- Проверить, что на пульте управления 2-й слева переключатель в нижнем положении (режим полёта по программе, см. [Стики и тумблеры](https://docs.geoscan.ru/pioneer/instructions/remote-controller/fsi6s/rc_controls.html))
- Проверить показания барометра в Pioneer Station, они не должны быть отрицательными. В случае, если они отрицательны, обесточить квадрокоптер, поставить его на пол и снова подать питание.
- Проверить заряд аккумулятора
- Проверить, что включен режим OPT в настройках автопилота в Pioneer Station

### Pioneer Station для Arch Linux
После установки Pioneer Station на Arch Linux согласно [инструкции](https://docs.geoscan.ru/pioneer/instructions/applications/pioneer_station/pioneer_station_install.html#linux)
квадрокоптер не подключается из программы, хотя устройство отображается в списке `lsusb`. Чтобы решить эту проблему, необходимо предоставить
пользователю права чтения и записи так же, как это делается для Arduino. Для этого нужно [добавить правило udev](https://wiki.archlinux.org/title/Arduino#Accessing_serial)
путем создания файла:

`/etc/udev/rules.d/01-ttyusb.rules`
```
SUBSYSTEMS=="usb-serial", TAG+="uaccess"
```
и после этого [перезагрузить правила udev](https://wiki.archlinux.org/title/Udev#Loading_new_rules):
```bash
udevadm control --reload
```

> [!WARNING]
> Данный способ позволяет *любому* пользователю, который вошёл в систему, получить доступ ко *всем* USB-serial устройствам.

## Полезные ссылки
- [Программирование ТРИК на Python и JavaScript](https://help.trikset.com/trik/programming-code)
- [trikRuntime wiki](https://github.com/trikset/trikRuntime/wiki)
- [Документация Геоскан Пионер](https://docs.geoscan.ru/pioneer/index.html)

